import os
import threading
from flask import Flask
from pyrogram import Client, filters
from pyrogram.types import Message

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ”‘  ENV VARIABLES
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
API_ID = int(os.getenv("API_ID"))
API_HASH = os.getenv("API_HASH")
BOT_TOKEN = os.getenv("BOT_TOKEN")

# Koyeb sets PORT automatically; default 8000 for local run
PORT = int(os.getenv("PORT", "8000"))

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸŒ  Minimal Flask app for health-check
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
flask_app = Flask(__name__)

@flask_app.route("/", methods=["GET", "HEAD"])
def index():
    return "âœ“ Bot is alive!", 200

def run_web():
    """Start Flask in a separate thread so it doesn't block the bot."""
    flask_app.run(host="0.0.0.0", port=PORT)

threading.Thread(target=run_web, daemon=True).start()

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ¤–  Telegram Bot (Pyrogram)
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
app = Client(
    "auto_reply_bot",
    api_id=API_ID,
    api_hash=API_HASH,
    bot_token=BOT_TOKEN
)

START_TEXT = """
ğŸ‘‹ ğ‡ğğ¥ğ¥ğ¨ {mention}!

à¦†à¦®à¦¿ à¦…à¦Ÿà§‹-à¦ªà§‹à¦¸à§à¦Ÿ-à¦œà§‡à¦¨à¦¾à¦°à§‡à¦Ÿà¦° à¦¬à¦Ÿ ğŸ¤–  
à¦¯à§‡ à¦•à§‹à¦¨à§‹ à¦®à§à¦­à¦¿-à¦Ÿà¦¾à¦‡à¦Ÿà§‡à¦² à¦¬à¦¾ à¦›à¦¬à¦¿ à¦ªà¦¾à¦ à¦¾à¦²à§‡ à¦¨à¦¿à¦œà§‡ à¦¥à§‡à¦•à§‡ à¦«à¦°à¦®à§à¦¯à¦¾à¦Ÿà§‡à¦¡ à¦ªà§‹à¦¸à§à¦Ÿ à¦¬à¦¾à¦¨à¦¿à§Ÿà§‡ à¦°à§‡à¦ªà§à¦²à¦¾à¦‡ à¦•à¦°à¦¬à§‹à¥¤

â€¢ à¦¶à§à¦§à§ à¦›à¦¬à¦¿ à¦ªà¦¾à¦ à¦¾à¦²à§‡ â€” à¦¸à§‡à¦‡ à¦›à¦¬à¦¿à¦‡ à¦¥à¦¾à¦•à¦¬à§‡  
â€¢ à¦¶à§à¦§à§ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦ªà¦¾à¦ à¦¾à¦²à§‡ â€” à¦²à§‹à¦—à§‹ à¦›à¦¾à§œà¦¾ à¦Ÿà§‡à¦•à§à¦¸à¦Ÿ à¦«à¦°à¦®à§à¦¯à¦¾à¦Ÿ à¦•à¦°à¦¬à§‹  
"""

REPLY_TEMPLATE = """
ğŸ¬ @PrimeCineHub {caption}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ“¥ á´›á´‡ÊŸá´‡É¢Ê€á´€á´ á´…ÉªÊ€á´‡á´„á´› á´…á´á´¡É´ÊŸá´á´€á´… Ò“ÉªÊŸá´‡ ğŸ“¥
â”â”â”â”â° ğŸ“º á´ Éªá´…á´‡á´ Ç«á´œá´€ÊŸÉªá´›Ê ğŸ“º â±â”â”âŠ±

ğŸ“ 480á´˜
ğŸ”— 

ğŸ“ 720á´˜
ğŸ”— 

ğŸ“ 1080á´˜
ğŸ”— 

â•­â”â° ğŸ“š Êœá´á´¡ á´›á´ á´…á´á´¡É´ÊŸá´á´€á´… á´›á´œá´›á´Ê€Éªá´€ÊŸ á´ Éªá´…á´‡á´ ğŸ¥ â±â”âŠ±
â”ƒ      <a href='https://t.me/Prime_Movie_Watch_Dawnload/71'>ğŸ‘‰ ğŸ”´ Êœá´á´¡ á´›á´ á´…á´á´¡É´ÊŸá´á´€á´… ğŸ”´ ğŸ‘ˆ</a>
â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”âŠ±

ğŸ’¬ á´Šá´ÉªÉ´ á´á´œÊ€ á´„Êœá´€É´É´á´‡ÊŸ & É¢Ê€á´á´œá´˜êœ±
ğŸ”—âœ‡ https://t.me/addlist/ceobDOjc7202ZmVl

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸ”” êœ±á´›á´€Ê á´›á´œÉ´á´‡á´… êœ°á´Ê€ á´á´Ê€á´‡ á´œá´˜á´…á´€á´›á´‡êœ±
ğŸ“½ï¸ É´á´‡á´¡ á´á´á´ Éªá´‡êœ±, êœ±á´‡Ê€Éªá´‡êœ± & á´á´Ê€á´‡ á´‡á´ á´‡Ê€Ê á´…á´€Ê!
ğŸ“© á´¡á´‡'Ê€á´‡ Êœá´‡Ê€á´‡ á´›á´ á´…á´‡ÊŸÉªá´ á´‡Ê€ á´›Êœá´‡ Ê™á´‡êœ±á´› á´‡É´á´›á´‡Ê€á´›á´€ÉªÉ´á´á´‡É´á´›!
"""

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸ“œ  Handlers
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

@app.on_message(filters.private & filters.command("start"))
async def start_cmd(_, message: Message):
    await message.reply_text(
        START_TEXT.format(mention=message.from_user.mention),
        disable_web_page_preview=True
    )

@app.on_message(filters.private & (filters.photo | filters.text))
async def auto_reply(_, message: Message):
    # Skip if this is the /start command itself
    if message.text and message.text.startswith("/"):
        return

    caption = (message.caption or message.text or "Untitled").strip()
    reply_text = REPLY_TEMPLATE.format(caption=caption)

    if message.photo:
        await message.reply_photo(message.photo.file_id, caption=reply_text)
    else:
        await message.reply_text(reply_text)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# ğŸš€  Run bot
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
app.run()
